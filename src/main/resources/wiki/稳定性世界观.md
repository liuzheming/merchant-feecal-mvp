# 稳定性世界观（面试表达框架）

## 1. 定义
稳定性不是“系统不挂”，而是“在压力、故障、波动下还能提供可预期的结果”。核心目标是：
- 可预期：正确 / 一致 / 可恢复
- 可控：有边界 / 限流 / 降级
- 可观测：能定位 / 能回滚 / 能复盘

## 2. 分层视角（入口、流程、数据、依赖、资源）

### 2.1 入口层（防放大）
- 手段：限流、幂等、排队
- 目标：控制洪峰与重复触发
- 示例：批次 start 只能触发一次，重复请求返回同批次

### 2.2 流程层（可恢复）
- 手段：状态机、重试、补偿
- 目标：将复杂流程拆成可恢复节点
- 示例：PENDING → LOADING → READY → DONE/FAILED，每一步可重试，不跨状态写

### 2.3 数据层（可一致）
- 手段：事务边界、幂等表、唯一键
- 目标：写入可去重、失败可回滚
- 示例：资金指令生成用唯一业务键防重复

### 2.4 依赖层（可降级）
- 手段：超时、熔断、降级、隔离
- 目标：依赖异常时系统自我保护
- 示例：上游拉账失败，标记 FAILED，等待重试

### 2.5 资源层（可控耗）
- 手段：线程池、连接池、批处理
- 目标：避免单次大请求拖垮系统
- 示例：账单快照分页写入、批量插入

## 3. 极端场景的解释方法
示例：500 门店 * 100 费用项 * 1000 账单，单请求扩散为 5e7 级别处理量。

稳定性策略：
1) 先限边界（排队 / 限流 / 分批）
2) 再保证可恢复（状态机 + 幂等 + 重试）
3) 最后可观测（指标 / 日志 / 慢 SQL）

## 4. 稳定性 = 设计 + 运行时验证
- 设计：限流 / 幂等 / 状态机 / 降级 / 重试
- 验证：压测 + 故障注入 + 复盘

稳定性不是一次性实现，是持续演进。
